<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Happy New Year 2026</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@300;400;600&display=swap" rel="stylesheet" crossorigin="anonymous">
    <style>
        body {
            background: radial-gradient(circle at center, #1a1a2e 0%, #020205 100%);
            font-family: 'Poppins', sans-serif;
            overflow-x: hidden;
            color: #fff;
        }

        .cursive {
            font-family: 'Great Vibes', cursive;
        }

        .gold-text {
            background: linear-gradient(to bottom, #cf9d38 22%, #ffefbb 45%, #bf953f 50%, #fcf6ba 67%, #b38728 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(191, 149, 63, 0.5));
        }

        .card-container {
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 215, 0, 0.2);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f2d74e;
            top: -10px;
            z-index: 0;
            animation: fall linear infinite;
        }

        @keyframes fall {
            to { transform: translateY(100vh) rotate(360deg); }
        }

        #preview-img {
            max-height: 280px;
            width: auto;
            max-width: 100%;
            object-fit: contain;
            border: 3px solid #bf953f;
            padding: 5px;
            background: rgba(255,255,255,0.05);
            cursor: pointer;
        }

        .loader {
            border-top-color: #bf953f;
            animation: spinner 1.5s linear infinite;
        }

        @keyframes spinner {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .input-style {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(191, 149, 63, 0.5);
            color: white;
            transition: all 0.3s ease;
        }

        .input-style:focus {
            outline: none;
            border-color: #fcf6ba;
            background: rgba(255, 255, 255, 0.15);
        }

        /* Overlay for music activation */
        #music-overlay {
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- Music Activation Overlay (For shared links) -->
    <div id="music-overlay" class="fixed inset-0 z-[100] flex items-center justify-center hidden">
        <div class="text-center p-6 card-container rounded-3xl">
            <h3 class="cursive gold-text text-4xl mb-4">Aapke liye ek Message hai!</h3>
            <button id="start-wish-btn" class="bg-gradient-to-r from-yellow-600 to-yellow-400 text-black font-bold py-4 px-10 rounded-full shadow-lg hover:scale-105 transition-transform flex items-center justify-center gap-2 mx-auto">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M18 8a3 3 0 0 0-3-3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V8Z"/><path d="M10 12v3"/><path d="M6 15v-2"/><path d="M14 15v-5"/><path d="M18 8c0-3.3-2.7-6-6-6"/></svg>
                Open & Wish
            </button>
        </div>
    </div>

    <!-- Background Confetti Container -->
    <div id="confetti-wrapper" class="fixed inset-0 pointer-events-none"></div>

    <div class="card-container bg-black/40 p-8 rounded-3xl max-w-md w-full text-center relative z-10">
        <h1 class="cursive gold-text text-6xl mb-2">Happy New Year</h1>
        <h2 class="text-5xl font-bold tracking-tighter mb-4 text-white">2026</h2>
        
        <p class="text-gray-300 italic mb-8">"May the coming year be full of grand adventures and opportunities."</p>

        <!-- Image Section -->
        <div id="image-display" class="hidden mb-6">
            <p class="text-[10px] text-yellow-500 mb-2 uppercase text-center">Your Custom Card</p>
            <a id="image-link" href="#" target="_blank">
                <img id="preview-img" src="" alt="Your Photo" class="rounded-2xl mx-auto shadow-2xl">
            </a>
        </div>

        <!-- Dynamic Name Display -->
        <div id="name-display" class="hidden mb-6">
            <p class="text-sm text-gray-400 uppercase tracking-widest mb-1">Warm Regards From</p>
            <p id="final-name" class="cursive gold-text text-5xl mt-1"></p>
        </div>

        <!-- Customization Form -->
        <div id="form-section" class="space-y-4 mb-8">
            <div>
                <label class="block text-xs font-semibold uppercase text-gold-text mb-2 text-left tracking-wider">Your Name</label>
                <input type="text" id="name-input" placeholder="Enter your name here..." 
                       class="input-style w-full py-3 px-4 rounded-xl placeholder-gray-600">
            </div>

            <div>
                <label class="block text-xs font-semibold uppercase text-gold-text mb-2 text-left tracking-wider">Your Photo</label>
                <input type="file" id="photo-input" accept="image/*" class="block w-full text-sm text-gray-400
                    file:mr-4 file:py-2 file:px-6
                    file:rounded-full file:border-0
                    file:text-sm file:font-bold
                    file:bg-gradient-to-r file:from-yellow-700 file:to-yellow-500 file:text-white
                    hover:file:opacity-90 transition-all cursor-pointer">
            </div>
        </div>

        <!-- Controls -->
        <div class="flex flex-col gap-4">
            <button id="upload-btn" class="bg-gradient-to-r from-yellow-600 to-yellow-400 text-black font-bold py-4 px-6 rounded-full shadow-lg hover:scale-105 transition-transform flex items-center justify-center gap-2">
                <span id="btn-text">Generate My Card</span>
                <div id="spinner" class="loader ease-linear rounded-full border-2 border-t-2 border-gray-200 h-5 w-5 hidden"></div>
            </button>

   <script async="async" data-cfasync="false" src="https://pl28326330.effectivegatecpm.com/12f929f9f7713427404f8ffcc4d65764/invoke.js"></script>
<div id="container-12f929f9f7713427404f8ffcc4d65764"></div>   
          
            <!-- WhatsApp Share Button -->
            <div id="share-controls" class="hidden flex flex-col gap-3">
                <button id="share-btn" class="bg-[#25D366] text-white font-bold py-4 px-6 rounded-full shadow-lg hover:scale-105 transition-transform flex items-center justify-center gap-2">
                    <svg viewBox="0 0 24 24" class="w-6 h-6 fill-current"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/></svg>
                    Share My Design
                </button>
                <button onclick="window.location.href=window.location.pathname" class="text-30px text-gray-400 hover:text-white underline">
                    Create New Card
                </button>
            </div>
        </div>

        <p class="text-[10px] text-gray-500 mt-10 uppercase letter-spacing-2">Premium Digital Greeting Card Â© 2026</p>
    </div>

    <!-- Background Music -->
    <audio id="bg-music" loop preload="auto">
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>

    <script>
        const apiKey = "2bf24b0bb3a1d49579ba85f1e7f999b9";
        let uploadedImageUrl = "";

        const photoInput = document.getElementById('photo-input');
        const nameInput = document.getElementById('name-input');
        const uploadBtn = document.getElementById('upload-btn');
        const shareBtn = document.getElementById('share-btn');
        const shareControls = document.getElementById('share-controls');
        const btnText = document.getElementById('btn-text');
        const spinner = document.getElementById('spinner');
        const previewImg = document.getElementById('preview-img');
        const imageLink = document.getElementById('image-link');
        const imageDisplay = document.getElementById('image-display');
        const nameDisplay = document.getElementById('name-display');
        const finalName = document.getElementById('final-name');
        const formSection = document.getElementById('form-section');
        const audio = document.getElementById('bg-music');
        const musicOverlay = document.getElementById('music-overlay');
        const startWishBtn = document.getElementById('start-wish-btn');

        function createConfetti() {
            const wrapper = document.getElementById('confetti-wrapper');
            if (!wrapper) return;
            const colors = ['#f2d74e', '#ffffff', '#bf953f', '#ffd700'];
            for (let i = 0; i < 70; i++) {
                const confetto = document.createElement('div');
                confetto.classList.add('confetti');
                confetto.style.left = Math.random() * 100 + 'vw';
                confetto.style.animationDuration = (Math.random() * 3 + 2) + 's';
                confetto.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetto.style.opacity = Math.random();
                wrapper.appendChild(confetto);
            }
        }

        // AI Voice Wish Function
        function speakWish() {
            if ('speechSynthesis' in window) {
                // Cancel any ongoing speech first
                window.speechSynthesis.cancel();
                
                const msg = new SpeechSynthesisUtterance();
                msg.text = "Happy New Year 2026";
                msg.rate = 0.95;
                msg.pitch = 1.1;
                msg.volume = 1.0;
                
                // Try to find a nice female voice
                const voices = window.speechSynthesis.getVoices();
                const femaleVoice = voices.find(v => v.name.includes('Female') || v.name.includes('Google UK English Female') || v.name.includes('Samantha'));
                if (femaleVoice) msg.voice = femaleVoice;
                
                window.speechSynthesis.speak(msg);
            }
        }

        startWishBtn.addEventListener('click', () => {
            musicOverlay.classList.add('hidden');
            // Play background music and voice together
            audio.volume = 0.5; // Background music slightly lower
            audio.play().catch(e => console.log("Audio failed"));
            speakWish();
        });

        // Check for URL parameters on load
        window.onload = function() {
            createConfetti();
            
            // Populate voices early for speech synthesis
            if ('speechSynthesis' in window) {
                window.speechSynthesis.getVoices();
            }

            const urlParams = new URLSearchParams(window.location.search);
            const sharedName = urlParams.get('name');
            const sharedImg = urlParams.get('img');

            if (sharedName && sharedImg) {
                musicOverlay.classList.remove('hidden');
                finalName.textContent = decodeURIComponent(sharedName);
                previewImg.src = decodeURIComponent(sharedImg);
                imageLink.href = decodeURIComponent(sharedImg);
                imageDisplay.classList.remove('hidden');
                nameDisplay.classList.remove('hidden');
                formSection.classList.add('hidden');
                uploadBtn.classList.add('hidden');
                shareControls.classList.remove('hidden');
                nameInput.value = decodeURIComponent(sharedName);
                uploadedImageUrl = decodeURIComponent(sharedImg);
            }
        };

        uploadBtn.addEventListener('click', async () => {
            const file = photoInput.files[0];
            const userName = nameInput.value.trim();

            if (!userName) {
                showSimpleToast("Kripya apna naam bharein!");
                return;
            }
            if (!file) {
                showSimpleToast("Kripya ek photo select karein!");
                return;
            }

            // Test audio/voice on generate click
            audio.volume = 0.5;
            audio.play().catch(e => console.log("Audio deferred"));
            speakWish();

            btnText.textContent = "Design Tyar Ho Raha Hai...";
            spinner.classList.remove('hidden');
            uploadBtn.disabled = true;

            const formData = new FormData();
            formData.append("image", file);

            try {
                let attempt = 0;
                let success = false;
                let data;

                while (attempt < 3 && !success) {
                    try {
                        const response = await fetch(`https://api.imgbb.com/1/upload?key=${apiKey}`, {
                            method: "POST",
                            body: formData
                        });
                        data = await response.json();
                        if (data.success) success = true;
                        else throw new Error("API Response failed");
                    } catch (err) {
                        attempt++;
                        if (attempt < 3) await new Promise(res => setTimeout(res, 1000 * attempt));
                        else throw err;
                    }
                }

                if (success) {
                    uploadedImageUrl = data.data.url;
                    finalName.textContent = userName;
                    previewImg.src = uploadedImageUrl;
                    imageLink.href = uploadedImageUrl; 
                    imageDisplay.classList.remove('hidden');
                    nameDisplay.classList.remove('hidden');
                    formSection.classList.add('hidden');
                    uploadBtn.classList.add('hidden');
                    shareControls.classList.remove('hidden');
                } else {
                    throw new Error("Upload failed");
                }
            } catch (error) {
                console.error("Error:", error);
                showSimpleToast("Kuch galat hua. Try again.");
            } finally {
                btnText.textContent = "Generate My Card";
                spinner.classList.add('hidden');
                uploadBtn.disabled = false;
            }
        });

        function showSimpleToast(text) {
            const msg = document.createElement('div');
            msg.textContent = text;
            msg.className = "fixed top-5 left-1/2 -translate-x-1/2 bg-red-600 text-white px-6 py-3 rounded-full z-50 shadow-xl font-bold transition-opacity";
            document.body.appendChild(msg);
            setTimeout(() => {
                msg.style.opacity = '0';
                setTimeout(() => msg.remove(), 500);
            }, 3000);
        }

        shareBtn.addEventListener('click', () => {
            const userName = nameInput.value.trim();
            const baseUrl = window.location.origin + window.location.pathname;
            const shareUrl = `${baseUrl}?name=${encodeURIComponent(userName)}&img=${encodeURIComponent(uploadedImageUrl)}`;
            const message = `âœ¨ *Happy New Year 2026!* âœ¨\n\n*${userName}* ne aapke liye yeh special design bheja hai! ðŸ¥‚\n\nIsse dekhne ke liye yahan click karein (Music + Voice Wish):\nðŸ‘‰ ${shareUrl}\n\nAap bhi apna card bana sakte hain!`;
            const whatsappUrl = `https://api.whatsapp.com/send?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        });
    </script>
</body>
</html>
